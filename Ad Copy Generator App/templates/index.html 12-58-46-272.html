<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <title>Google Ads Copy Generator</title>
    <style>
      * {
        box-sizing: border-box;
        margin: 0;
        padding: 0;
      }

      body {
        font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto,
          Oxygen, Ubuntu, sans-serif;
        line-height: 1.6;
        padding: 2rem;
        max-width: 800px;
        margin: 0 auto;
        background-color: #f5f5f5;
      }

      h1 {
        color: #2c3e50;
        margin-bottom: 2rem;
        text-align: center;
      }

      .alert-messages {
        margin-bottom: 2rem;
      }

      .alert-messages ul {
        list-style: none;
        padding: 1rem;
        background-color: #fff3cd;
        border: 1px solid #ffeeba;
        border-radius: 4px;
        color: #856404;
      }

      form {
        background: white;
        padding: 2rem;
        border-radius: 8px;
        box-shadow: 0 2px 4px rgba(0, 0, 0, 0.1);
      }

      .form-group {
        margin-bottom: 1.5rem;
      }

      label {
        display: block;
        margin-bottom: 0.5rem;
        color: #2c3e50;
        font-weight: 500;
      }

      input[type="url"],
      input[type="text"],
      textarea,
      select {
        width: 100%;
        padding: 0.75rem;
        border: 1px solid #ddd;
        border-radius: 4px;
        font-size: 1rem;
        transition: border-color 0.2s;
      }

      input[type="file"] {
        padding: 0.5rem 0;
      }

      textarea {
        min-height: 100px;
        resize: vertical;
      }

      input:focus,
      textarea:focus,
      select:focus {
        outline: none;
        border-color: #3498db;
        box-shadow: 0 0 0 2px rgba(52, 152, 219, 0.2);
      }

      button {
        background-color: #3498db;
        color: white;
        padding: 0.75rem 2rem;
        border: none;
        border-radius: 4px;
        font-size: 1rem;
        cursor: pointer;
        width: 100%;
        transition: background-color 0.2s;
      }

      button:hover {
        background-color: #2980b9;
      }

      .required-field::after {
        content: " *";
        color: #e74c3c;
      }

      .form-tabs {
        display: flex;
        margin-bottom: 2rem;
        border-bottom: 2px solid #ddd;
      }

      .tab {
        padding: 1rem 2rem;
        background: none;
        border: none;
        border-bottom: 2px solid transparent;
        margin-bottom: -2px;
        color: #666;
        cursor: pointer;
        font-weight: 500;
      }

      .tab.active {
        color: #3498db;
        border-bottom-color: #3498db;
      }

      #loading-overlay {
        position: fixed;
        top: 0;
        left: 0;
        width: 100%;
        height: 100%;
        background-color: rgba(0, 0, 0, 0.8);
        display: none;
        flex-direction: column;
        justify-content: center;
        align-items: center;
        z-index: 9999;
      }

      .spinner {
        width: 50px;
        height: 50px;
        border: 5px solid #f3f3f3;
        border-top: 5px solid #3498db;
        border-radius: 50%;
        animation: spin 1s linear infinite;
      }

      @keyframes spin {
        0% {
          transform: rotate(0deg);
        }
        100% {
          transform: rotate(360deg);
        }
      }

      .loading-text {
        color: white;
        margin-top: 1rem;
        font-size: 1.1rem;
      }

      .loading-progress {
        margin-top: 1rem;
        width: 300px;
        text-align: center;
      }

      .progress-bar {
        width: 100%;
        height: 20px;
        background-color: rgba(255, 255, 255, 0.3);
        border-radius: 10px;
        overflow: hidden;
        margin-bottom: 0.5rem;
      }

      .progress-fill {
        height: 100%;
        background-color: #3498db;
        width: 0%;
        transition: width 0.3s ease;
        animation: progress-animation 2s ease-in-out infinite;
      }

      @keyframes progress-animation {
        0% {
          width: 0%;
        }
        50% {
          width: 70%;
        }
        100% {
          width: 100%;
        }
      }

      .progress-text {
        color: white;
        font-size: 0.9rem;
      }
    </style>
  </head>
  <body>
    <div id="loading-overlay">
      <div class="spinner"></div>
      <div class="loading-text">Generating Ad Copy...</div>
      <div class="loading-progress" style="display: none">
        <div class="progress-bar">
          <div class="progress-fill"></div>
        </div>
        <div class="progress-text">Processing...</div>
      </div>
    </div>

    <h1>Google Ads Copy Generator</h1>
    {% with messages = get_flashed_messages() %} {% if messages %}
    <div class="alert-messages">
      <ul>
        {% for message in messages %}
        <li>{{ message }}</li>
        {% endfor %}
      </ul>
    </div>
    {% endif %} {% endwith %}

    <div class="form-tabs">
      <button class="tab active">Single Ad Generation</button>
      <button class="tab">Bulk Ad Generation</button>
      <button class="tab">SEO Generation</button>
      <button class="tab">Bulk SEO Generation</button>
    </div>

    <form method="POST" enctype="multipart/form-data" id="single-form">
      <div class="form-group">
        <label for="target_url" class="required-field">Target URL</label>
        <input type="url" name="target_url" id="target_url" required />
      </div>

      <div class="form-group">
        <label for="target_keywords" class="required-field"
          >Target Keywords</label
        >
        <input
          type="text"
          name="target_keywords"
          id="target_keywords"
          required
        />
      </div>

      <div class="form-group">
        <label for="brand_name" class="required-field">Brand Name</label>
        <input type="text" name="brand_name" id="brand_name" required />
      </div>

      <div class="form-group">
        <label for="selling_points">Selling Points</label>
        <textarea
          name="selling_points"
          id="selling_points"
          placeholder="Enter your key selling points (optional)"
        ></textarea>
      </div>

      <div class="form-group">
        <label for="case_type" class="required-field">Case Type</label>
        <select name="case_type" id="case_type" required>
          <option value="sentence">Sentence case</option>
          <option value="title">Title Case</option>
        </select>
      </div>

      <button type="submit">Generate Single Ad</button>
    </form>

    <form
      method="POST"
      enctype="multipart/form-data"
      id="bulk-form"
      style="display: none"
    >
      <div class="form-group">
        <label for="csv_file" class="required-field"
          >Campaign Structure CSV</label
        >
        <input
          type="file"
          name="csv_file"
          id="csv_file"
          accept=".csv"
          required
        />
      </div>

      <button type="submit">Continue to Column Mapping</button>
    </form>

    <form
      method="POST"
      enctype="multipart/form-data"
      id="seo-form"
      style="display: none"
    >
      <div class="form-group">
        <label for="seo_target_url" class="required-field">Target URL</label>
        <input type="url" name="target_url" id="seo_target_url" required />
      </div>

      <div class="form-group">
        <label for="seo_target_keywords" class="required-field"
          >Target Keywords</label
        >
        <input
          type="text"
          name="target_keywords"
          id="seo_target_keywords"
          required
        />
      </div>

      <div class="form-group">
        <label for="seo_brand_name" class="required-field">Brand Name</label>
        <input type="text" name="brand_name" id="seo_brand_name" required />
      </div>

      <div class="form-group">
        <label for="seo_selling_points">Selling Points</label>
        <textarea
          name="selling_points"
          id="seo_selling_points"
          placeholder="Enter your key selling points (optional)"
        ></textarea>
      </div>

      <div class="form-group">
        <label for="seo_case_type" class="required-field">Case Type</label>
        <select name="case_type" id="seo_case_type" required>
          <option value="sentence">Sentence case</option>
          <option value="title">Title Case</option>
        </select>
      </div>

      <input type="hidden" name="seo_generation" value="true" />

      <button type="submit">Generate SEO Content</button>
    </form>

    <form
      method="POST"
      enctype="multipart/form-data"
      id="bulk-seo-form"
      style="display: none"
    >
      <div class="form-group">
        <label for="bulk_seo_csv">CSV File with URLs (Optional)</label>
        <input
          type="file"
          name="bulk_seo_csv"
          id="bulk_seo_csv"
          accept=".csv"
        />
        <p class="help-text">
          CSV should have columns: URL (required), Keywords (optional), Brand
          Name (optional)
        </p>
      </div>

      <div class="form-group">
        <label for="bulk_seo_urls">Or Paste URLs (One per line)</label>
        <textarea
          name="urls"
          id="bulk_seo_urls"
          placeholder="https://example.com/page1&#10;https://example.com/page2&#10;https://example.com/page3"
          rows="5"
        ></textarea>
        <p class="help-text">
          Enter one URL per line. You can use either this or the CSV upload
          above.
        </p>
      </div>

      <div class="form-group">
        <label for="bulk_seo_content_type" class="required-field"
          >Content Type</label
        >
        <select name="content_type" id="bulk_seo_content_type" required>
          <option value="both">Both Title Tags and Meta Descriptions</option>
          <option value="titles">Title Tags Only</option>
          <option value="descriptions">Meta Descriptions Only</option>
        </select>
      </div>

      <div class="form-group">
        <label for="bulk_seo_variations" class="required-field"
          >Number of Variations</label
        >
        <input
          type="number"
          name="variations"
          id="bulk_seo_variations"
          min="1"
          max="10"
          value="3"
          required
        />
        <p class="help-text">
          How many variations to generate for each URL (1-10)
        </p>
      </div>

      <div class="form-group">
        <label for="bulk_seo_brand_name" class="required-field"
          >Default Brand Name</label
        >
        <input
          type="text"
          name="brand_name"
          id="bulk_seo_brand_name"
          required
        />
        <p class="help-text">
          This will be used if no brand name is specified in the CSV
        </p>
      </div>

      <div class="form-group">
        <label for="bulk_seo_selling_points">Default Selling Points</label>
        <textarea
          name="selling_points"
          id="bulk_seo_selling_points"
          placeholder="Enter default selling points (optional)"
        ></textarea>
        <p class="help-text">
          These will be used if no selling points are specified in the CSV
        </p>
      </div>

      <div class="form-group">
        <label for="bulk_seo_case_type" class="required-field">Case Type</label>
        <select name="case_type" id="bulk_seo_case_type" required>
          <option value="sentence">Sentence case</option>
          <option value="title">Title Case</option>
        </select>
      </div>

      <input type="hidden" name="bulk_seo_generation" value="true" />

      <button type="submit">Generate Bulk SEO Content</button>
    </form>

    <script>
      function showLoading() {
        document.getElementById("loading-overlay").style.display = "flex";
      }

      function hideLoading() {
        document.getElementById("loading-overlay").style.display = "none";
        // Reset progress
        document.querySelector(".loading-progress").style.display = "none";
        document.querySelector(".loading-text").textContent =
          "Generating Ad Copy...";
      }

      function showProgress() {
        document.querySelector(".loading-progress").style.display = "block";
      }

      document.addEventListener("DOMContentLoaded", function () {
        const tabs = document.querySelectorAll(".tab");
        const singleForm = document.getElementById("single-form");
        const bulkForm = document.getElementById("bulk-form");
        const seoForm = document.getElementById("seo-form");
        const bulkSeoForm = document.getElementById("bulk-seo-form");

        // Add validation for bulk SEO form
        const bulkSeoFormElement = document.getElementById("bulk-seo-form");
        const bulkSeoCsvInput = document.getElementById("bulk_seo_csv");
        const bulkSeoUrlsInput = document.getElementById("bulk_seo_urls");
        const bulkSeoVariationsInput = document.getElementById(
          "bulk_seo_variations"
        );

        bulkSeoFormElement.addEventListener("submit", function (e) {
          if (!bulkSeoCsvInput.files.length && !bulkSeoUrlsInput.value.trim()) {
            e.preventDefault();
            alert("Please either upload a CSV file or paste URLs");
          }

          // Validate variations number
          const variations = parseInt(bulkSeoVariationsInput.value);
          if (variations < 1 || variations > 10) {
            e.preventDefault();
            alert("Number of variations must be between 1 and 10");
          }
        });

        tabs?.forEach((tab, index) => {
          tab.addEventListener("click", () => {
            tabs.forEach((t) => t.classList.remove("active"));
            tab.classList.add("active");

            // Hide all forms
            singleForm.style.display = "none";
            bulkForm.style.display = "none";
            seoForm.style.display = "none";
            bulkSeoForm.style.display = "none";

            // Show the selected form
            if (index === 0) {
              singleForm.style.display = "block";
            } else if (index === 1) {
              bulkForm.style.display = "block";
            } else if (index === 2) {
              seoForm.style.display = "block";
            } else if (index === 3) {
              bulkSeoForm.style.display = "block";
            }
          });
        });

        document.querySelectorAll("form").forEach((form) => {
          form.addEventListener("submit", function (e) {
            showLoading();

            if (form.id === "bulk-form" || form.id === "bulk-seo-form") {
              // For bulk forms, use async approach to properly handle the download
              e.preventDefault();

              // Update loading text for bulk SEO
              if (form.id === "bulk-seo-form") {
                document.querySelector(".loading-text").textContent =
                  "Generating Bulk SEO Content...";
              } else {
                document.querySelector(".loading-text").textContent =
                  "Generating Bulk Ad Copy...";
              }

              // Show progress indicator for bulk operations
              showProgress();

              // Set a timeout to prevent infinite loading (10 minutes)
              const timeoutId = setTimeout(() => {
                hideLoading();
                alert(
                  "The operation is taking longer than expected. Please try again or contact support if the issue persists."
                );
              }, 600000); // 10 minutes

              fetch(form.action, {
                method: "POST",
                body: new FormData(form),
              })
                .then((response) => {
                  clearTimeout(timeoutId); // Clear timeout on success
                  if (response.ok) {
                    // Check if the response is a CSV file
                    const contentType = response.headers.get("content-type");
                    if (contentType && contentType.includes("text/csv")) {
                      // For CSV downloads, hide loading and trigger download
                      hideLoading();
                      return response.blob().then((blob) => {
                        const url = window.URL.createObjectURL(blob);
                        const a = document.createElement("a");
                        a.href = url;
                        a.download = "seo_output.csv";
                        document.body.appendChild(a);
                        a.click();
                        window.URL.revokeObjectURL(url);
                        a.remove();
                      });
                    } else {
                      // For other responses, handle as before
                      return response.text().then((html) => {
                        hideLoading();
                        // Create a temporary div to parse the HTML
                        const parser = new DOMParser();
                        const doc = parser.parseFromString(html, "text/html");

                        // Check if we got a result page
                        if (
                          doc.querySelector(".ad-container") ||
                          doc.querySelector(".seo-container")
                        ) {
                          // Replace the current page content with the result page
                          document.documentElement.innerHTML =
                            doc.documentElement.innerHTML;
                          // Re-run any scripts
                          const scripts = doc.getElementsByTagName("script");
                          for (let script of scripts) {
                            eval(script.textContent);
                          }
                        } else {
                          // If not a result page, redirect to the response URL
                          window.location.href = response.url;
                        }
                      });
                    }
                  } else {
                    // Handle error response
                    hideLoading();
                    return response.text().then((text) => {
                      // Try to parse as JSON for error messages
                      try {
                        const data = JSON.parse(text);
                        alert(data.message || "An error occurred");
                      } catch {
                        // If not JSON, show the text
                        alert(text || "An error occurred");
                      }
                    });
                  }
                })
                .catch((error) => {
                  clearTimeout(timeoutId); // Clear timeout on error
                  hideLoading();
                  console.error("Error:", error);
                  alert("An error occurred while generating the content.");
                });

              return false; // Prevent form submission
            }

            e.preventDefault();
            fetch(form.action, {
              method: "POST",
              body: new FormData(form),
            })
              .then((response) => {
                if (response.ok) {
                  // Check if the response is a CSV file
                  const contentType = response.headers.get("content-type");
                  if (contentType && contentType.includes("text/csv")) {
                    // For CSV downloads, hide loading and trigger download
                    hideLoading();
                    return response.blob().then((blob) => {
                      const url = window.URL.createObjectURL(blob);
                      const a = document.createElement("a");
                      a.href = url;
                      a.download = "output.csv";
                      document.body.appendChild(a);
                      a.click();
                      window.URL.revokeObjectURL(url);
                      a.remove();
                    });
                  }

                  // For HTML responses, get the content
                  return response.text().then((html) => {
                    hideLoading();
                    // Create a temporary div to parse the HTML
                    const parser = new DOMParser();
                    const doc = parser.parseFromString(html, "text/html");

                    // Check if we got a result page
                    if (
                      doc.querySelector(".ad-container") ||
                      doc.querySelector(".seo-container")
                    ) {
                      // Replace the current page content with the result page
                      document.documentElement.innerHTML =
                        doc.documentElement.innerHTML;
                      // Re-run any scripts
                      const scripts = doc.getElementsByTagName("script");
                      for (let script of scripts) {
                        eval(script.textContent);
                      }
                    } else {
                      // If not a result page, redirect to the response URL
                      window.location.href = response.url;
                    }
                  });
                } else {
                  // Handle error response
                  hideLoading();
                  return response.text().then((text) => {
                    // Try to parse as JSON for error messages
                    try {
                      const data = JSON.parse(text);
                      alert(data.message || "An error occurred");
                    } catch {
                      // If not JSON, show the text
                      alert(text || "An error occurred");
                    }
                  });
                }
              })
              .catch((error) => {
                hideLoading();
                console.error("Error:", error);
                alert("An error occurred while generating the content.");
              });
          });
        });
      });
    </script>
  </body>
</html>
