<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <title>Keyword Research Tool</title>
    <style>
      * {
        box-sizing: border-box;
        margin: 0;
        padding: 0;
      }

      body {
        font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto,
          Oxygen, Ubuntu, sans-serif;
        line-height: 1.6;
        padding: 2rem;
        max-width: 800px;
        margin: 0 auto;
        background-color: #f5f5f5;
      }

      h1 {
        color: #2c3e50;
        margin-bottom: 2rem;
        text-align: center;
      }

      form {
        background: white;
        padding: 2rem;
        border-radius: 8px;
        box-shadow: 0 2px 4px rgba(0, 0, 0, 0.1);
      }

      .form-group {
        margin-bottom: 1.5rem;
      }

      label {
        display: block;
        margin-bottom: 0.5rem;
        color: #2c3e50;
        font-weight: 500;
      }

      textarea {
        width: 100%;
        min-height: 200px;
        padding: 0.75rem;
        border: 1px solid #ddd;
        border-radius: 4px;
        font-size: 1rem;
        font-family: inherit;
        resize: vertical;
      }

      textarea:focus {
        outline: none;
        border-color: #3498db;
        box-shadow: 0 0 0 2px rgba(52, 152, 219, 0.2);
      }

      button {
        background-color: #3498db;
        color: white;
        padding: 0.75rem 2rem;
        border: none;
        border-radius: 4px;
        font-size: 1rem;
        cursor: pointer;
        width: 100%;
        transition: background-color 0.2s;
      }

      button:hover {
        background-color: #2980b9;
      }

      #loading-overlay {
        position: fixed;
        top: 0;
        left: 0;
        width: 100%;
        height: 100%;
        background-color: rgba(0, 0, 0, 0.8);
        display: none;
        flex-direction: column;
        justify-content: center;
        align-items: center;
        z-index: 9999;
      }

      .spinner {
        width: 50px;
        height: 50px;
        border: 5px solid #f3f3f3;
        border-top: 5px solid #3498db;
        border-radius: 50%;
        animation: spin 1s linear infinite;
      }

      @keyframes spin {
        0% {
          transform: rotate(0deg);
        }
        100% {
          transform: rotate(360deg);
        }
      }

      .loading-text {
        color: white;
        margin-top: 1rem;
        font-size: 1.1rem;
      }
    </style>
  </head>
  <body>
    <div
      id="loading-overlay"
      style="
        display: none;
        position: fixed;
        top: 0;
        left: 0;
        width: 100%;
        height: 100%;
        background: rgba(0, 0, 0, 0.5);
        z-index: 1000;
      "
    >
      <div
        style="
          position: absolute;
          top: 50%;
          left: 50%;
          transform: translate(-50%, -50%);
          color: white;
          text-align: center;
        "
      >
        <div class="spinner"></div>
        <p>Analyzing URLs and generating keywords...</p>
      </div>
    </div>

    <h1>Keyword Research Tool</h1>

    <form method="POST" id="keyword-form">
      <div class="form-group">
        <label for="urls">Enter URLs (one per line)</label>
        <textarea
          name="urls"
          id="urls"
          required
          placeholder="https://example.com/page1&#10;https://example.com/page2&#10;https://example.com/page3"
        ></textarea>
      </div>

      <button type="submit">Generate Keywords</button>
    </form>

    <script>
      document.getElementById("keyword-form").onsubmit = function (e) {
        e.preventDefault();

        // Show loading overlay
        document.getElementById("loading-overlay").style.display = "block";

        // Get form data
        const formData = new FormData(this);

        // Make the request
        fetch("/keyword-research/", {
          method: "POST",
          body: formData,
        })
          .then((response) => {
            // Hide loading overlay
            document.getElementById("loading-overlay").style.display = "none";

            if (response.ok) {
              if (response.headers.get("Content-Type") === "application/json") {
                // Handle JSON response (error case)
                return response.json().then((data) => {
                  alert(data.message || "An error occurred");
                });
              } else {
                // Handle successful CSV download
                return response.blob().then((blob) => {
                  const url = window.URL.createObjectURL(blob);
                  const a = document.createElement("a");
                  a.href = url;
                  a.download = "keyword_research.csv";
                  document.body.appendChild(a);
                  a.click();
                  window.URL.revokeObjectURL(url);
                  a.remove();
                });
              }
            } else {
              // Handle HTTP error
              return response.json().then((data) => {
                alert(data.message || "An error occurred");
              });
            }
          })
          .catch((error) => {
            // Hide loading overlay and show error
            document.getElementById("loading-overlay").style.display = "none";
            alert("An error occurred while processing your request");
            console.error("Error:", error);
          });
      };

      // Add some basic styles for the spinner
      const style = document.createElement("style");
      style.textContent = `
        .spinner {
            width: 50px;
            height: 50px;
            border: 5px solid #f3f3f3;
            border-top: 5px solid #3498db;
            border-radius: 50%;
            animation: spin 1s linear infinite;
            margin: 0 auto 20px auto;
        }
        
        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }
    `;
      document.head.appendChild(style);
    </script>
  </body>
</html>
